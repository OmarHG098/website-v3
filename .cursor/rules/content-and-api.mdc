---
description: Content loading patterns, YAML structure, API conventions, and component registry
globs: "server/**/*.ts,marketing-content/**,shared/**",server/**/*.ts,shared/**
alwaysApply: false
---
# Content and API Patterns

## Content Loading

Use `loadContent`, `listContentSlugs`, `loadCommonData` from [server/utils/contentLoader.ts](server/utils/contentLoader.ts). Always validate with Zod schemas from `@shared/schema`.

## YAML Structure

Top-level `meta` (SEO, redirects) and `sections` array. Sections: `type`, `variant`, `version`, `data`. Locale/variant files per [cursor-instructions](.cursor/rules/cursor-instructions.mdc).

## API Responses

- **Success**: `{ ...data }` or `{ success: true, data }`.
- **Errors**: `res.status(4xx|5xx).json({ error: "message" })`. Use 404 for missing content, 400 for validation, 401 for auth, 403 for forbidden, 500 for server errors. Include `details` when helpful (e.g. validation errors).
- **Auth in dev**: `X-Debug-Token` bypass where applicable.

## Component Registry

Add/modify components in `marketing-content/component-registry/{name}/vX.Y/`. Provide `schema.ts` (Zod), `examples/`, and optional `schema.yml` (use schema-sync script). Reuse shared schemas from `@shared/schema` (e.g. `ctaButtonSchema`, `imageSchema`).

After schema changes, run `npx tsx scripts/schema-sync/sync-schemas.ts` when `schema.yml` is used. Ensure `shared/schema` exports new section types if they are used in app code.
